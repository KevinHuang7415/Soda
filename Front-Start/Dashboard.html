<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>商家後台管理</title>
<link rel="stylesheet" href="./css/normalize.css">
<link rel="stylesheet" href="./css/main_setting.css">
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<style>
    body {
        background-color: #ECF0F1;
        font-family: Arial, sans-serif;
    }

    .header {
        display: flex;
        background-color: #026cd6;
        justify-content: space-between;
        align-items: center;
        padding: 0 20px;
    }

    .header img {
        padding: 10px 0;
        width: 200px;
    }

    .header .userImg {
        width: 50px;
        object-fit: contain;
        margin-left: 10px;
        cursor: pointer;
    }

    .main {
        margin: 20px;
    }

    .tab {
        margin-bottom: 20px;
    }

    .tab button {
        padding: 10px 20px;
        margin-right: 10px;
        cursor: pointer;
        border: none;
        background-color: #3498db;
        color: white;
        border-radius: 5px;
    }

    .tab button.active {
        background-color: #2c3e50;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
    }

    table, th, td {
        border: 1px solid #ccc;
    }

    th, td {
        padding: 10px;
        text-align: left;
    }

    input, select {
        padding: 5px;
        margin-right: 10px;
    }

    .form-inline {
        margin-bottom: 10px;
    }
</style>
</head>

<body>
<div class="wrap">
    <div class="header">
        <div class="logo">
            <img src="./images/logo.png" alt="Logo">
        </div>
        <div>
            <img src="./images/dashboard/soft-drinks.svg" alt="" class="userImg" title="商品管理" onclick="showTab('products')">
            <img src="./images/dashboard/ui-note.svg" alt="" class="userImg" title="訂單管理" onclick="showTab('orders')">
            <img src="./images/dashboard/manage-user.svg" alt="" class="userImg" title="用戶管理" onclick="showTab('users')">
            <img src="./images/dashboard/ticket-simple-solid-full.svg" alt="" class="userImg" title="優惠管理" onclick="showTab('coupons')">
        </div>
    </div>

    <div class="main">
        <!-- 商品管理 -->
        <div id="products" class="tabContent">
            <h2>商品管理</h2>
            <div class="form-inline">
                <input type="text" id="productName" placeholder="商品名稱">
                <input type="number" id="productPrice" placeholder="價格">
                <button onclick="addProduct()">新增商品</button>
            </div>
            <table id="productTable">
                <thead>
                    <tr><th>ID</th><th>名稱</th><th>價格</th><th>操作</th></tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <!-- 訂單管理 -->
        <div id="orders" class="tabContent" style="display:none;">
            <h2>訂單管理</h2>
            <table id="orderTable">
                <thead>
                    <tr><th>訂單ID</th><th>用戶ID</th><th>商品列表</th><th>總金額</th></tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <!-- 用戶管理 -->
        <div id="users" class="tabContent" style="display:none;">
            <h2>用戶管理</h2>
            <table id="userTable">
                <thead>
                    <tr><th>ID</th><th>名稱</th><th>Email</th></tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <!-- 優惠管理 -->
        <div id="coupons" class="tabContent" style="display:none;">
            <h2>優惠管理</h2>
            <div class="form-inline">
                <input type="text" id="couponCode" placeholder="優惠代碼">
                <input type="number" id="couponDiscount" placeholder="折扣百分比">
                <button onclick="addCoupon()">新增優惠</button>
            </div>
            <table id="couponTable">
                <thead>
                    <tr><th>ID</th><th>代碼</th><th>折扣%</th><th>操作</th></tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
</div>

<script>
// 切換頁籤 
function showTab(tabId) {
    document.querySelectorAll('.tabContent').forEach(t => t.style.display = 'none');
    document.getElementById(tabId).style.display = 'block';
}

// 商品管理 API 
function loadProducts() {
    axios.get('/api/products')
    .then(res => {
        const tbody = document.querySelector('#productTable tbody');
        tbody.innerHTML = '';
        res.data.forEach(p => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${p.id}</td>
                <td>${p.name}</td>
                <td>${p.price}</td>
                <td>
                    <button onclick="deleteProduct(${p.id})">刪除</button>
                </td>
            `;
            tbody.appendChild(tr);
        });
    });
}

function addProduct() {
    const name = document.getElementById('productName').value;
    const price = Number(document.getElementById('productPrice').value);
    axios.post('/api/products', { name, price })
    .then(() => loadProducts());
}

function deleteProduct(id) {
    axios.delete(`/api/products/${id}`)
    .then(() => loadProducts());
}

// 訂單管理 API 
function loadOrders() {
    axios.get('/api/orders')
    .then(res => {
        const tbody = document.querySelector('#orderTable tbody');
        tbody.innerHTML = '';
        res.data.forEach(o => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${o.id}</td>
                <td>${o.userId}</td>
                <td>${o.items.map(i => i.name).join(', ')}</td>
                <td>${o.total}</td>
            `;
            tbody.appendChild(tr);
        });
    });
}

// 用戶管理 API 
function loadUsers() {
    axios.get('/api/users')
    .then(res => {
        const tbody = document.querySelector('#userTable tbody');
        tbody.innerHTML = '';
        res.data.forEach(u => {
            const tr = document.createElement('tr');
            tr.innerHTML = `<td>${u.id}</td><td>${u.name}</td><td>${u.email}</td>`;
            tbody.appendChild(tr);
        });
    });
}

// 優惠管理 API
function loadCoupons() {
    axios.get('/api/coupons')
    .then(res => {
        const tbody = document.querySelector('#couponTable tbody');
        tbody.innerHTML = '';
        res.data.forEach(c => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${c.id}</td>
                <td>${c.code}</td>
                <td>${c.discount}</td>
                <td><button onclick="deleteCoupon(${c.id})">刪除</button></td>
            `;
            tbody.appendChild(tr);
        });
    });
}

function addCoupon() {
    const code = document.getElementById('couponCode').value;
    const discount = Number(document.getElementById('couponDiscount').value);
    axios.post('/api/coupons', { code, discount })
    .then(() => loadCoupons());
}

function deleteCoupon(id) {
    axios.delete(`/api/coupons/${id}`)
    .then(() => loadCoupons());
}


showTab('products');
loadProducts();
loadOrders();
loadUsers();
loadCoupons();

</script>
</body>
</html>
