<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>註冊資料</title>
  <!-- Reset -->
  <link rel="stylesheet" href="../css/Reset.css">
  <!-- main_setting -->
  <link rel="stylesheet" href="../css/main_setting.css">
  <!-- style.css -->
  <link rel="stylesheet" href="../css/shoppingCart_style.css">
  <!-- axios -->
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

  <style>
    /* register CSS */
    body {
      background: var(--light-yellow);
    }

    .containerAcc {
      margin: auto;
      width: calc(300px + (300) * ((100vw - 480px) / (1200 - 480)));
      /* 在 480px 寬螢幕時寬度約為 300px
         在 1200px 寬螢幕時寬度約為 800px
         之間會平滑變化 */
    }

    .titleAcc {
      width: 100%
    }

    .containerAcc h1 {
      font-size: 4em;
      font-weight: bold;
      margin-bottom: 20px;
      line-height: 1.1;
    }

    .containerAcc label {
      display: block;
      font-size: 24px;
      margin-bottom: 6px;
    }

    .containerAcc input {
      width: 92%;
      padding: 24px;
      border: 1px solid #ccc;
      border-radius: 10px;
      margin-bottom: 20px;
      font-size: 24px;
    }

    .formAcc button {
      display: block;
    }

    .alc {
      text-align: center;
    }

    .mgt {
      margin-top: 40px;
    }

    @font-face {
      font-family: "FakePearl-regular";
      /* 自訂名稱 */
      src: url("../fonts/FakePearl-regular.ttf") format("truetype");
      /* 字體檔路徑 */
      font-weight: normal;
      font-style: normal;
    }

    /* 套用字體 */
    body {
      font-family: "FakePearl-regular", sans-serif;
    }

    @media (max-width: 768px) {
      .containerAcc h1 {
        font-size: 2em;
      }

      .containerAcc label {
        font-size: 16px;
      }

      .containerAcc input {
        font-size: 16px;
        padding: 20px;
      }

    }

    /* register CSS end */
  </style>
</head>

<body>
  <div class="containerAcc">
    <div class="titleAcc">
      <h1 class="alc mgt">註冊個人資料</h1>
    </div>
    <div id="messageContainer" style="color:red; text-align:center; margin-bottom:10px;"></div>
    <form class="formAcc" id="formAcc">
      <label for="UserName">使用者名稱</label>
      <input type="text" id="UserName" placeholder="test">

      <label for="FirstName">姓氏</label>
      <input type="text" id="FirstName" placeholder="王">

      <label for="LastName">名字</label>
      <input type="text" id="LastName" placeholder="小明">

      <label for="Email">電子郵箱</label>
      <input type="email" id="Email" placeholder="abc123@gmail.com">

      <label for="Password">密碼</label>
      <input type="password" id="Password" placeholder="XXXX - XXXX">

      <button type="button" class="btn btn-l alc" onclick="register()">註冊</button>
    </form>
  </div>
</body>
<script>
  function showMessage(message, type = 'error') {
    const container = document.getElementById('messageContainer');
    container.textContent = message;
    container.style.color = type === 'error' ? 'red' : 'green';
    setTimeout(() => {
        container.textContent = '';
    }, 3000);
}

function register() {
    const UserName = document.getElementById('UserName').value.trim();
    const FirstName = document.getElementById('FirstName').value.trim();
    const LastName = document.getElementById('LastName').value.trim();
    const Email = document.getElementById('Email').value.trim();
    const Password = document.getElementById('Password').value.trim();
    if (!UserName || !FirstName || !LastName || !Email || !Password) {
        showMessage('請輸入完整內容');
        return;
    }
    const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailPattern.test(Email)) {
        showMessage('Email 格式不正確');
        return;
    }
    axios.post('https://localhost:7085/api/createUsers', {
        Username: UserName,
        FirstName: FirstName,
        LastName: LastName,
        Email: Email,
        Password: Password
    })
    .then(res => {
        showMessage(res.data.message, 'success');
        document.getElementById('formAcc').reset();
    })
    .catch(err => {
        if (err.response) {
            if (err.response.status === 400) {
                const errors = err.response.data;
                let messages = [];
                for (const key in errors) {
                    if (Array.isArray(errors[key])) {
                        messages.push(...errors[key]);
                    } else {
                        messages.push(errors[key]);
                    }
                }
                showMessage(messages.join('\n'));
            } else  if(err.response.status === 409) {
                showMessage(err.response.data.message);
            } 
        } else {
            showMessage('無法連線到伺服器');
        }
    });
}

</script>

</html>