<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>註冊資料</title>
  <!-- Reset -->
  <link rel="stylesheet" href="./css/Reset.css">
  <!-- main_setting -->
  <link rel="stylesheet" href="./css/main_setting.css">
  <!-- style.css -->
  <link rel="stylesheet" href="./css/shoppingCar.css">
   <!-- nav.js -->
    <script src="./js/nav.js"></script>
    <!-- ShoppingCart CSS -->
    <link rel="stylesheet" href="./css/shoppingCart_style.css">
  <!-- axios -->
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <!-- GSAP -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/2.1.2/TweenMax.min.js"></script>
    <!-- bubbles.js -->
    <script src="./js/bubbles.js"></script>
  <!-- Footer -->
  <script src="./js/footer.js"></script>


  <style>
    html,
    body {
      height: 100%;
      margin: 0;
      padding: 0;
    }


    /* register CSS */
    body {
      background: var(--light-yellow);
      display: flex;
      flex-direction: column;
    }
    
    /* 讓主要內容區域佔滿剩餘空間 */
    .containerAcc {
      margin: 100px auto;
      width: calc(300px + (300) * ((100vw - 480px) / (1200 - 480)));
      /* 在 480px 寬螢幕時寬度約為 300px
         在 1200px 寬螢幕時寬度約為 800px
         之間會平滑變化 */
      flex: 1;
      padding: 2rem 1rem;
    }

    .titleAcc {
      width: 100%
    }

    .containerAcc h1 {
      font-size: 4em;
      font-weight: bold;
      margin-bottom: 20px;
      line-height: 1.1;
    }

    .containerAcc label {
      display: block;
      font-size: 24px;
      margin-bottom: 6px;
    }

    .containerAcc input {
      width: 92%;
      padding: 24px;
      border: 1px solid #ccc;
      border-radius: 10px;
      margin-bottom: 20px;
      font-size: 24px;
    }

    .formAcc button {
      display: block;
    }

    .alc {
      text-align: center;
    }

    .mgt {
      margin-top: 40px;
    }



    @media (max-width: 768px) {
      .containerAcc h1 {
        font-size: 2em;
      }

      .containerAcc label {
        font-size: 16px;
      }

      .containerAcc input {
        font-size: 16px;
        padding: 20px;
      }

    }

    /* register CSS end */
  </style>
</head>

<body>

  <div class="containerAcc">
    <div class="titleAcc">
      <h1 class="alc mgt">註冊個人資料</h1>
    </div>
    <div id="messageContainer" style="color:red; text-align:center; margin-bottom:10px;"></div>
    <form class="formAcc" id="formAcc">
      <label for="UserName">使用者名稱</label>
      <input type="text" id="UserName" placeholder="test">

      <!-- <label for="FirstName">姓氏</label>
      <input type="text" id="FirstName" placeholder="王">

      <label for="LastName">名字</label>
      <input type="text" id="LastName" placeholder="小明"> -->

      <label for="Email">電子郵箱</label>
      <input type="email" id="Email" placeholder="abc123@gmail.com">

      <label for="Password">密碼</label>
      <input type="password" id="Password" placeholder="XXXX - XXXX">
      <!-- <label for="Password">Address</label>
      <input type="text" id="Address" placeholder="XXXX - XXXX"> -->

      <button type="button" class="btn btn-l alc" onclick="register()">註冊</button>
    </form>

</body>
<!-- jQuery -->
<script src="./js/jquery-3.4.1.min.js"></script>
<script>
  function showMessage(message, type = 'error') {
    const container = document.getElementById('messageContainer');
    container.innerHTML = message;
    container.style.color = type === 'error' ? 'red' : 'green';
    setTimeout(() => {
      container.textContent = '';
    }, 3000);
  }

  function register() {
    const UserName = document.getElementById('UserName').value.trim();
    // const FirstName = document.getElementById('FirstName').value.trim();
    // const LastName = document.getElementById('LastName').value.trim();
    const Email = document.getElementById('Email').value.trim();
    const Password = document.getElementById('Password').value.trim();
    // const Address = document.getElementById('Address').value.trim();
    if (!UserName || !Email || !Password) {
      showMessage('請輸入完整內容');
      return;
    }
    const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailPattern.test(Email)) {
      showMessage('Email 格式不正確');
      return;
    }
    axios.post('https://localhost:7085/api/Auth/register', {
      Username: UserName,
      // FirstName: FirstName,
      // LastName: LastName,
      Email: Email,
      Password: Password
      // Address: Address
    })
      .then(res => {
        showMessage(res.data.message + '三秒後跳轉，若無跳轉請點此 <a href="./login.html">登入</a>', 'success');
        document.getElementById('formAcc').reset();

        setTimeout(() => {
          window.location.href = './login.html';
        }, 3000);
      })
      .catch(err => {
        if (err.response) {
          if (err.response.status === 400) {
            const errors = err.response.data;
            let messages = [];
            for (const key in errors) {
              if (Array.isArray(errors[key])) {
                messages.push(...errors[key]);
              } else {
                messages.push(errors[key]);
              }
            }
            showMessage(messages.join('\n'));
          } else if (err.response.status === 409) {
            showMessage(err.response.data.message);
          }
        } else {
          showMessage('無法連線到伺服器');
        }
      });
  }

      // 初始化泡泡動畫
      initBubbles({
      maxBubbles: 15  // 較少的泡泡數量，避免干擾登入表單
    });

</script>

</html>