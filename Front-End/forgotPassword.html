<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>忘記密碼</title>
  <!-- Reset -->
  <link rel="stylesheet" href="./css/Reset.css">
  <!-- main_setting -->
  <link rel="stylesheet" href="./css/main_setting.css">
  <!-- nav.js -->
  <script src="./js/nav.js"></script>
  <!-- style.css -->
  <link rel="stylesheet" href="./css/shoppingCart_style.css">
  <!-- axios -->
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <!-- jQuery -->
  <script src="./js/jquery-3.4.1.min.js"></script>
  <style>
    /* register CSS */
    html,
    body {
      height: 100%;
      margin: 0;
      padding: 0;
    }

    body {
      background: var(--light-yellow);
      display: flex;
      flex-direction: column;
    }

    /* Footer 置底樣式 */
    footer {
      margin-bottom: 0;
    }

    .containerAcc {
      margin: auto;
      width: calc(300px + (300) * ((100vw - 480px) / (1200 - 480)));
      /* 在 480px 寬螢幕時寬度約為 300px
         在 1200px 寬螢幕時寬度約為 800px
         之間會平滑變化 */
    }

    .titleAcc {
      width: 100%
    }

    .containerAcc h1 {
      font-size: 4em;
      font-weight: bold;
      margin-bottom: 20px;
      line-height: 1.1;
    }

    .containerAcc label {
      display: block;
      font-size: 24px;
      margin-bottom: 6px;
    }

    .containerAcc input {
      width: 92%;
      padding: 24px;
      border: 1px solid #ccc;
      border-radius: 10px;
      margin-bottom: 20px;
      font-size: 24px;
    }

    .formAcc button {
      display: block;
    }

    .alc {
      text-align: center;
    }

    .mgt {
      margin-top: 40px;
    }

    .size-12 {
      font-size: 12px;
    }

    @font-face {
      font-family: "FakePearl-regular";
      /* 自訂名稱 */
      src: url("../fonts/FakePearl-regular.ttf") format("truetype");
      /* 字體檔路徑 */
      font-weight: normal;
      font-style: normal;
    }

    /* 套用字體 */
    body {
      font-family: "FakePearl-regular", sans-serif;
    }

    @media (max-width: 768px) {
      .containerAcc h1 {
        font-size: 2em;
      }

      .containerAcc label {
        font-size: 16px;
      }

      .containerAcc input {
        font-size: 16px;
        padding: 20px;
      }

    }

    /* register CSS end */
  </style>
</head>

<body>
  <div class="containerAcc">
    <div id="messageContainer" style="color:red; text-align:center; margin-bottom:10px;"></div>
    <div class="titleAcc">
      <h1 class="alc mgt">忘記密碼</h1>
      <p class="alc">請輸入您的電子郵件，我們將會寄送密碼重設連結給您。</p>
    </div>
    <form class="formAcc mgt" id="formAcc">
      <label for="Email">電子郵箱</label>
      <input type="email" id="Email" placeholder="abc123@gmail.com">

      <button type="button" class="btn btn-l alc" onclick="sendEmail()">送信</button>
    </form>
  </div>
  <div id="site-footer"></div>
  <!-- Include script -->
  <script src="./js/include.js"></script>
  <script>
    function showMessage(message, type = 'error') {
      const container = document.getElementById('messageContainer');
      container.textContent = message;
      container.style.color = type === 'error' ? 'red' : 'green';
      setTimeout(() => {
        container.textContent = '';
      }, 3000);
    }
    function sendEmail() {
      const Email = document.getElementById('Email').value.trim();
      console.log(Email);
      if (!Email) {
        showMessage('請輸入完整內容');
        return;
      }
      const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailPattern.test(Email)) {
        showMessage('Email 格式不正確');
        return;
      }
      axios.post('https://localhost:7085/api/Auth/forgot-password',{
        Email:Email
      })
      .then(res => {
        showMessage(res.data.message, 'success');
        document.getElementById('formAcc').reset();

        setTimeout(() => {
          window.location.href = './login.html';
        }, 3000);
      })
      .catch(err => {
        if (err.response) {
          if (err.response.status === 400) {
            const errors = err.response.data;
            let messages = [];
            for (const key in errors) {
              if (Array.isArray(errors[key])) {
                messages.push(...errors[key]);
              } else {
                messages.push(errors[key]);
              }
            }
            showMessage(messages.join('\n'));
          } else if (err.response.status === 409) {
            showMessage(err.response.data.message);
          }
        } else {
          showMessage('無法連線到伺服器');
        }
      });

    }
  </script>
</body>

</html>