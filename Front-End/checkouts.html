<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>checkouts</title>
    <!-- Reset -->
    <link rel="stylesheet" href="./css/Reset.css">
    <!-- main_setting -->
    <link rel="stylesheet" href="./css/main_setting.css">
    <!-- CSS -->
    <link rel="stylesheet" href="./css/checkouts_style.css">
    <!-- axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <!-- 身份驗證輔助函數 -->
    <script src="./js/auth-helper.js"></script>
</head>

<body>
    <div class="checkouts-header">
        <a href="./index.html"><img class="logo" src="./images/logo.png" alt="logo" title="返回首頁"></a>
        <a href="./prodoct.html" class="backPd-btn"><img src="./images/icon/4781813_bag_buy_cart_market_shop_icon.png"
                alt="shoppingCar" title="返回商品頁面"></a>
    </div>

    <div class="marquee-container">
        <div class="marquee-content" id="discount-marquee" title="點一下可以複製優惠卷到欄位中">
            <!-- 跑馬燈內容將由 JavaScript 動態生成 -->
        </div>
    </div>
    <div class="checkouts-main">
        <div class="list-title-box">
            <div class="list-title">
                訂單摘要
                <img src="./images/icon/8674511_ic_fluent_chevron_up_regular_icon.svg" alt="">
            </div>
            <div class="list-title-sum">
                <h5>$2,335</h5>
            </div>
        </div>
        <div class="order-list">
            <div class="order-item-box">
                <div class="order-item-img" id="order-item-img" name="order-item-img">
                    <span class="order-item-quantity">6</span>
                    <h2>12</h2>
                    <img src="./images/lemon-lime_mockup.png" alt="Lemon">
                </div>
                <div class="order-item-info">
                    <div class="order-item-sel-box">
                        <div class="order-item-name">
                            檸檬能量飲
                        </div>
                        <div class="order-item-size">
                            <p>
                                12 x 355ml
                            </p>
                        </div>
                    </div>
                    <div class="order-item-subtotal">$2,994</div>
                </div>
            </div>
            <form action="#" method="get" class="gift-box">
                <input type="text" placeholder="禮物卡或是折扣碼" class="input-box gift-box">
                <button type="submit" class="gift-btn">使用</button>
            </form>
            <div class="discount-box">
                <p>折扣</p>
                <div class="discount-item" id="subtotal-item">
                    <p>小計 · <span id="total-items">6</span> 件</p>
                    <p id="subtotal-amount">$2,994</p>
                </div>
                <div id="discount-items-container">
                    <!-- 動態折扣項目將在這裡添加 -->
                </div>
            </div>
            <div class="total-box">
                <h4>總計</h4>
                <h5>$2,335</h5>
            </div>
        </div>
        <div class="pay-container">
            <p class="pay-container-title fontSize14 fontGray">快速結帳</p>
            <div class="pay-way-box">
                <img class="pay-way-btn applePay" src="./images/icon/8666205_apple_pay_icon_white.png" alt="applePay">
                <img class="pay-way-btn googlePay" src="./images/icon/8546747_google_pay_icon_white.png"
                    alt="googlePay">
                <img class="pay-way-btn amazonPay" src="./images/icon/8666126_amazon_pay_icon_white.png"
                    alt="amazonPay">
            </div>
            <p class="fontSize14 fontGray">繼續付款即表示您同意本頁列出的未來費用和取消政策。</p>
            <div class="or-divider"><span>或</span></div>
            <div class="form-box">
                <div class="contact-box">
                    <div class="contact-box-title">
                        <h3>訂閱</h3>
                        <a href="./login.html" id="login-status-link">登入</a>
                    </div>
                    <div class="contact-box-emailBox">
                        <div class="input-wrapper">
                            <input class="input-box contact-input" type="email" id="email" placeholder="電子郵件">
                            <label for="email" class="floating-label">電子郵件</label>
                            <span class="error-message"></span>
                        </div>
                        <label for="sendemail">
                            <input type="checkbox" name="interest[]" id="sendemail" value="透過電子郵件向我發送新聞和優惠訊息" checked>
                            <span class="fontSize14">透過電子郵件向我發送新聞和優惠訊息</span>
                        </label>
                    </div>
                </div>
                <div class="delivery-box">
                    <h3>收件資料</h3>
                    <div class="input-wrapper">
                        <input class="input-box contact-input" type="text" id="deliveryFirstName" placeholder="收件人姓" required>
                        <label for="deliveryFirstName" class="floating-label">收件人姓</label>
                        <span class="error-message"></span>
                    </div>
                    <div class="input-wrapper">
                        <input class="input-box contact-input" type="text" id="deliveryLaName" placeholder="收件人名" required>
                        <label for="deliveryLaName" class="floating-label">收件人名</label>
                        <span class="error-message"></span>
                    </div>
                    <div class="input-wrapper">
                        <input class="input-box contact-input" type="tel" id="deliveryTel" placeholder="聯絡電話" required>
                        <label for="deliveryTel" class="floating-label">聯絡電話</label>
                        <span class="error-message"></span>
                    </div>
                    <div class="address-box">
                        <div class="city-container">
                            <div class="city-box">
                                <select id="city" class="select-box input-box" required>
                                    <option value="" selected disabled>中華民國縣市</option>
                                </select>
                            </div>
                            <div class="dustruct-box">
                                <select id="district" class="select-box input-box" required>
                                    <option value="" selected disabled>請先選擇縣市</option>
                                </select>
                            </div>
                            <input id="zipcode-input" class="select-box input-box zipcode-input" type="text" readonly
                                placeholder="自動帶入" title="郵遞區號">
                        </div>
                        <div class="input-wrapper">
                            <input class="input-box contact-input" type="text" id="addressName" placeholder="收件人地址" required>
                            <label for="addressName" class="floating-label">收件人地址</label>
                            <span class="error-message"></span>
                        </div>
                    </div>
                </div>
                <div class="paymentMethod-box">
                    <h3>付款方式</h3>
                    <p class="fontGray fontSize14">所有交易都是安全且加密的。</p>
                    <div class="creditCard-box">
                        <div class="input-wrapper">
                            <input class="input-box contact-input" type="text" id="cardNum" inputmode="numeric"
                                maxlength="19" placeholder="信用卡號" required>
                            <label for="cardNum" class="floating-label">信用卡號 (**** **** **** ****)</label>
                            <span class="error-message"></span>
                        </div>

                        <div class="card-expiry">
                            <select id="cardMonth" class="select-box input-box" required>
                                <option value="" selected disabled>月份</option>
                            </select>
                            <select id="cardYear" class="select-box input-box" required>
                                <option value="" selected disabled>年份</option>
                            </select>
                        </div>

                        <div class="input-wrapper">
                            <input class="input-box contact-input" type="text" id="cvv" inputmode="numeric"
                                maxlength="4" placeholder="CVV" required>
                            <label for="cvv" class="floating-label">CVV</label>
                            <span class="error-message"></span>
                        </div>

                        <div class="input-wrapper">
                            <input class="input-box contact-input" type="text" id="nameOnCard"
                                placeholder="持卡人姓名 (與卡片相同)" required>
                            <label for="nameOnCard" class="floating-label">持卡人姓名 (與卡片相同)</label>
                            <span class="error-message"></span>
                        </div>
                    </div>

                </div>
                <div class="pay-way-btn pay-now-btn">立即付款</div>

            </div>
            <div class="disclaimer-box">
                <a href="">退款政策</a>
                <a href="">隱私權政策</a>
                <a href="">服務條款</a>
                <a href="">取消</a>
            </div>
        </div>
    </div>

    <script src="./js/checkouts.js"></script>
    <script>
        // 檢查登入狀態（結帳頁必須登入）
        if (!requireLogin(true)) {
            // 未登入會自動導向登入頁，登入後返回此頁
        } else {
            // 已登入，初始化使用者資料
            initializeUserData();
        }

        // 初始化使用者資料
        function initializeUserData() {
            const user = getCurrentUser();
            
            if (!user) return;

            // 1. 更新登入狀態顯示
            const loginStatusLink = document.getElementById('login-status-link');
            if (loginStatusLink) {
                loginStatusLink.textContent = `Hi, ${user.username || user.email}`;
                loginStatusLink.href = 'javascript:void(0);';
                loginStatusLink.style.cursor = 'default';
                loginStatusLink.style.color = 'var(--main-green)';
                loginStatusLink.title = '已登入';
            }

            // 2. 自動填入 Email
            const emailInput = document.getElementById('email');
            if (emailInput && user.email) {
                emailInput.value = user.email;
                emailInput.readOnly = true; // 已登入使用者不能修改 email
                emailInput.style.backgroundColor = '#f5f5f5';
            }

            // 3. 自動填入姓名（如果有的話）
            const firstNameInput = document.getElementById('deliveryFirstName');
            const lastNameInput = document.getElementById('deliveryLaName');
            
            if (user.lastName && firstNameInput) {
                firstNameInput.value = user.lastName;
            }
            
            if (user.firstName && lastNameInput) {
                lastNameInput.value = user.firstName;
            }

            // 4. 自動填入地址（如果有的話）
            if (user.address) {
                const addressInput = document.getElementById('addressName');
                if (addressInput) {
                    addressInput.value = user.address;
                }
            }

            console.log('已自動填入使用者資料:', user);
        }
    </script>
</body>

</html>